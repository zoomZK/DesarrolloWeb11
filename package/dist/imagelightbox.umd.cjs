(function(A,$){typeof exports=="object"&&typeof module<"u"?$(exports):typeof define=="function"&&define.amd?define(["exports"],$):(A=typeof globalThis<"u"?globalThis:A||self,$(A.imagelightbox={}))})(this,function(A){"use strict";function $(e,n,r){const i=`${n}=${r}`;let o=`?${i}`;if(e){const t=new RegExp(`([?&])${n}=[^&]*`);t.exec(e)!==null?o=e.replace(t,`$1${i}`):o=`${e}&${i}`}return o}function B(e){const n=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(document.location.search);if((n==null?void 0:n[2])!==void 0)return decodeURIComponent(n[2].replace(/\+/g," "))}function j(e,n){let r=e;if(r){const i=new RegExp(`\\?${n}=[^&]*`),o=new RegExp(`&${n}=[^&]*`);r=r.replace(i,"?"),r=r.replace(o,"")}return r}var h=(e=>(e[e.Left=1]="Left",e[e.None=0]="None",e[e.Right=-1]="Right",e))(h||{});function J(){let e=j(document.location.search,"imageLightboxIndex");e=j(e,"imageLightboxSet"),window.history.pushState({},"",document.location.pathname+e)}function K(e,n,r){const i=r[e].dataset.ilb2Id??e.toString();let o=$(document.location.search,"imageLightboxIndex",i);const t={imageLightboxIndex:i,imageLightboxSet:""};n!==void 0&&(t.imageLightboxSet=n,o=$(o,"imageLightboxSet",n)),window.history.pushState(t,"",document.location.pathname+o)}function U(e,n,r){if(B("imageLightboxSet")!==e)return;const i=B("imageLightboxIndex");if(i===void 0)return;let o=n.findIndex(t=>t.dataset.ilb2Id===i);o<0&&(o=parseInt(i,10)),r(o,!0)}function G(e,n,r,i,o,t,s){const f=e.state;if(!f||Object.keys(f).length===0){t(!0);return}if(f.imageLightboxSet!==n)return;const u=f.imageLightboxIndex;if(u===void 0){t(!0);return}let m=r.findIndex(E=>E.dataset.ilb2Id===u);if(m<0&&(m=parseInt(u,10)),i===null){o(m,!0);return}s(m,m>i?h.Right:h.Left,!0)}const v=document.createElement("div");v.setAttribute("id","ilb-container");let F=null;function Y(e,n,r){v.classList.remove("ilb-overlay"),document.body.classList.add("ilb-body"),document.body.appendChild(v),n&&(F=i=>{i.stopPropagation(),r()},v.addEventListener("click",F),v.addEventListener("touchend",F)),v.style.transition=`opacity ${e.toString()}ms ease`,setTimeout(()=>{v.style.opacity="1"},50)}function Z(){v.classList.add("ilb-overlay")}function _(){v.style.opacity="0"}function ee(){F!==null&&(v.removeEventListener("click",F),v.removeEventListener("touchend",F)),v.remove(),v.textContent="",document.body.classList.remove("ilb-body")}function y(){return v}const D=document.createElement("div");D.setAttribute("id","ilb-activity-indicator"),D.appendChild(document.createElement("div"));function Q(){y().appendChild(D)}function W(){D.remove()}const w=document.createElement("div");w.classList.add("ilb-button","ilb-arrow"),w.setAttribute("id","ilb-arrow-left");const S=document.createElement("div");S.classList.add("ilb-button","ilb-arrow"),S.setAttribute("id","ilb-arrow-right");let O=null,k=null;function te(e,n){O=r=>{r.stopPropagation(),e()},k=r=>{r.stopPropagation(),n()},w.addEventListener("click",O),w.addEventListener("touchend",O),S.addEventListener("click",k),S.addEventListener("touchend",k),y().append(w,S)}function ne(){w.remove(),O!==null&&(w.removeEventListener("click",O),w.removeEventListener("touchend",O)),k!==null&&(S.removeEventListener("click",k),S.removeEventListener("touchend",k)),O=null,k=null}const L=document.createElement("caption");L.setAttribute("id","ilb-caption"),L.textContent="&nbsp;",L.addEventListener("click",e=>{e.stopPropagation()});function ie(e,n){e!==""?(y().appendChild(L),L.style.transition=`opacity ${n.toString()}ms ease`,setTimeout(()=>{L.style.opacity="1"},1),L.textContent=e):(L.style.opacity="0",setTimeout(()=>{L.remove()},n))}const N=document.createElement("button");N.classList.add("ilb-button"),N.setAttribute("id","ilb-close-button");let H=null;function oe(e){H=n=>{n.stopPropagation(),e()},N.addEventListener("click",H),y().appendChild(N)}function ae(){H!==null&&N.removeEventListener("click",H),N.remove()}const re=document.fullscreenEnabled||(document.webkitFullscreenEnabled??!1);function le(){return document.fullscreenElement??document.webkitFullscreenElement??null}const se=e=>{(e.requestFullscreen||e.webkitRequestFullScreen).call(e)},de=()=>{(document.exitFullscreen||document.webkitExitFullscreen).call(document)};function ce(){le()===null?se(y()):de()}const M=document.createElement("button");M.classList.add("ilb-button"),M.setAttribute("id","ilb-fullscreen-button"),M.innerHTML="&#x26F6;",M.addEventListener("click",e=>{e.stopPropagation(),ce()});function ue(){y().appendChild(M)}function fe(){M.remove()}function me(e,n,r){let i=0,o=0,t=document.createElement("img");t.setAttribute("id","ilb-image"),t.setAttribute("src",e.getAttribute("href")??"");const s=document.createElement("div");s.classList.add("ilb-image-container");let f;const u=e.dataset.ilb2VideoId;let m=e.dataset.ilb2Video!==void 0&&u!==void 0;if(m){const c=r.get(u);c!==void 0?[t,f]=c.element():m=!1}s.appendChild(t);function E(c,g,b,T){if(m){const a=r.get(u);if((a==null?void 0:a.shouldAutoplay())===!0){const[l,d]=a.element();d?l.play():l.autoplay=!0}}else t.addEventListener("click",a=>{if(a.stopPropagation(),n.quitOnImgClick){T();return}(a.pageX-t.offsetLeft)/t.width<=1/3?g():b()});t.addEventListener("touchstart",a=>{i=a.touches[0].pageX,t.style.transitionProperty="opacity"}),t.addEventListener("touchmove",a=>{o=a.touches[0].pageX-i,t.style.left=`${o.toString()}px`}),t.addEventListener("touchend",a=>{a.stopPropagation(),t.style.transitionProperty="left, opacity",o>50&&g(),o<-50&&b(),t.style.left="0"}),t.addEventListener("touchcancel",a=>{a.stopPropagation(),t.style.transitionProperty="left, opacity",t.style.left="0"}),c()}function I(c,g){y().appendChild(s);const b=Math.abs(100-n.gutter);t.style.maxHeight=`${b.toString()}%`,t.style.maxWidth=`${b.toString()}%`,t.style.left=`${(-100*c).toString()}px`,t.style.transition=`all ease ${n.animationSpeed.toString()}ms`,setTimeout(g,50)}function P(c,g){t.addEventListener("error",g),f===!0?c():(t.addEventListener("load",c),t.addEventListener("loadedmetadata",c))}function p(c,g,b,T){t.style.left="0",t.style.opacity="1",setTimeout(()=>{E(c,g,b,T)},n.animationSpeed)}function C(c,g){if(c!==h.None){const b=parseInt(t.style.left,10)||0;t.style.left=`${(b+100*c).toString()}px`}t.style.opacity="0",setTimeout(()=>{g()},n.animationSpeed)}function R(){s.remove()}return{addToDOM:I,removeFromDOM:R,startLoading:P,transitionIn:p,transitionOut:C}}let V=null;function ve(e,n,r,i){e.enableKeyboard&&(V=o=>{o.key==="Escape"&&(o.preventDefault(),n()),o.key==="ArrowLeft"&&(o.preventDefault(),r()),o.key==="ArrowRight"&&(o.preventDefault(),i())},document.addEventListener("keyup",V))}function ge(){V!==null&&document.removeEventListener("keyup",V)}const x=document.createElement("div");x.classList.add("ilb-navigation");function X(e,n,r,i){for(let o=0;o<e.length;o++){const t=document.createElement("button");t.style.transition=`background-color ${i.toString()}ms ease`;const s=()=>{const f=n();if(t.classList.contains("ilb-navigation-active")||f===null||t.parentNode===null)return;const u=Array.prototype.indexOf.call(t.parentNode.childNodes,t),m=u<f?h.Left:h.Right;r(u,m)};t.addEventListener("click",s),t.addEventListener("touchend",s),x.appendChild(t)}}function z(e){var n,r;for(let i=0;i<x.children.length;i++)(n=x.children.item(i))==null||n.classList.remove("ilb-navigation-active");(r=x.children.item(e))==null||r.classList.add("ilb-navigation-active")}function pe(e,n,r,i){x.textContent="",X(e,n,r,i);const o=n();o!==null&&z(o),y().appendChild(x),x.addEventListener("click",t=>{t.stopPropagation()}),x.addEventListener("touchend",t=>{t.stopPropagation()})}function be(e,n){let r=e.dataset.ilb2Id;r===void 0&&(r=`a${((1+Math.random())*65536|0).toString(16)}`),e.dataset.ilb2VideoId=r;const i=r,o=document.createElement("video");o.setAttribute("id","ilb-image"),o.preload="metadata",o.dataset.ilb2VideoId=i;let t=!1,s=!1;for(const[E,I]of Object.entries(n))switch(E){case"autoplay":s=!0;break;case"controls":case"loop":case"muted":case"poster":case"preload":case"src":o.setAttribute(E,I.toString());break}if(n.sources)for(const E of n.sources){const I=document.createElement("source");for(const[P,p]of Object.entries(E))I.setAttribute(P,p);o.appendChild(I)}o.addEventListener("loadedmetadata",()=>{t=!0});function f(){return i}function u(){return[o,t]}function m(){return s}return{element:u,id:f,shouldAutoplay:m}}function he(){const e=[];function n(i){for(const o of i){const t=o.dataset.ilb2Video;t!==void 0&&e.push(be(o,JSON.parse(t)))}}function r(i){return e.find(o=>o.id()===i)}return{add:n,get:r}}function ye(e,n,r){const i=[],o=he();let t=null,s=null;function f(){return n}function u(){return i}function m(a,l){if(s===null)return;const d=s;d.transitionOut(a,()=>{d.removeFromDOM(),l==null||l()})}function E(){s==null||s.transitionIn(W,R,c,p)}function I(a){s==null||s.addToDOM(a,()=>{var d;if(t===null)return;const l=i[t];if(e.caption&&ie(l.dataset.ilb2Caption??((d=l.getElementsByTagName("img").item(0))==null?void 0:d.alt)??"",e.animationSpeed),E(),e.preloadNext&&t+1<i.length){const q=i[t+1];document.createElement("img").setAttribute("src",q.getAttribute("href")??"")}y().dispatchEvent(new Event("ilb:loaded",{bubbles:!0}))})}function P(a,l){const d=me(i[a],e,o);t=a,s=d,d.startLoading(()=>{I(l)},()=>{W()})}function p(a=!1){t!==null&&(e.activity&&Q(),ge(),e.history&&!a&&J(),y().dispatchEvent(new Event("ilb:quit",{bubbles:!0})),_(),m(h.None,()=>{t=null,s=null,ne(),ae(),fe(),ee()}))}function C(a,l,d=!1){t!==null&&(e.history&&!d&&K(a,f(),u()),e.activity&&Q(),z(a),m(l),P(a,l))}function R(){if(t===null)return;let a=t-1;if(t===0){if(e.quitOnEnd){p();return}a=i.length-1}i[a].dispatchEvent(new Event("ilb:previous",{bubbles:!0})),C(a,h.Left)}function c(){if(t===null)return;let a=t+1;if(t===i.length-1){if(e.quitOnEnd){p();return}a=0}i[a].dispatchEvent(new Event("ilb:next",{bubbles:!0})),C(a,h.Right)}function g(a,l=!1){t===null&&(Y(e.animationSpeed,e.quitOnDocClick,p),e.activity&&Q(),ve(e,p,R,c),e.arrows&&te(R,c),e.button&&oe(p),e.fullscreen&&re&&ue(),e.overlay&&Z(),e.history&&!l&&K(a,f(),u()),i[a].dispatchEvent(new Event("ilb:start",{bubbles:!0})),P(a,h.None),e.navigation&&pe(u(),()=>t,C,e.animationSpeed))}function b(a){const l=i.indexOf(a);l<0||g(l)}function T(a){const l=a.filter(d=>!i.includes(d)).filter(d=>d.tagName.toLowerCase()==="a"&&(new RegExp(`.(${e.allowedTypes})$`,"i").test(d.href)||d.dataset.ilb2Video!==void 0));o.add(l),i.push(...l);for(const d of l)d.addEventListener("click",q=>{q.preventDefault(),q.stopPropagation(),b(d)});X(l,()=>t,C,e.animationSpeed)}return T(r),e.history&&window.addEventListener("popstate",a=>{G(a,f(),u(),t,g,p,C)}),{addImages:T,close:p,images:u,next:c,open:g,openWithImage:b,previous:R,set:f}}class Ee{constructor(n,r){const i={activity:!0,allowedTypes:"",animationSpeed:250,arrows:!0,button:!0,caption:!1,enableKeyboard:!0,fullscreen:!0,gutter:10,history:!1,navigation:!1,overlay:!0,preloadNext:!0,quitOnDocClick:!0,quitOnEnd:!0,quitOnImgClick:!1,...r};this.s=ye(i,n.length>0?n[0].dataset.imagelightbox??"":"",Array.from(n)),i.history&&this.openHistory()}addImages(n){this.s.addImages(Array.from(n))}close(){this.s.close()}next(){this.s.next()}open(n){n!==void 0?this.s.openWithImage(n):this.s.open(0)}openHistory(){U(this.s.set(),this.s.images(),(n,r)=>{this.s.open(n,r)})}previous(){this.s.previous()}}A.ImageLightbox=Ee,Object.defineProperty(A,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=imagelightbox.umd.cjs.map
