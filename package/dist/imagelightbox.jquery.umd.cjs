(function(h,F){typeof exports=="object"&&typeof module<"u"?F(require("jquery")):typeof define=="function"&&define.amd?define(["jquery"],F):(h=typeof globalThis<"u"?globalThis:h||self,F(h.jQuery))})(this,function(h){"use strict";function F(e,n,o){const i=`${n}=${o}`;let r=`?${i}`;if(e){const t=new RegExp(`([?&])${n}=[^&]*`);t.exec(e)!==null?r=e.replace(t,`$1${i}`):r=`${e}&${i}`}return r}function B(e){const n=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(document.location.search);if((n==null?void 0:n[2])!==void 0)return decodeURIComponent(n[2].replace(/\+/g," "))}function K(e,n){let o=e;if(o){const i=new RegExp(`\\?${n}=[^&]*`),r=new RegExp(`&${n}=[^&]*`);o=o.replace(i,"?"),o=o.replace(r,"")}return o}var y=(e=>(e[e.Left=1]="Left",e[e.None=0]="None",e[e.Right=-1]="Right",e))(y||{});function U(){let e=K(document.location.search,"imageLightboxIndex");e=K(e,"imageLightboxSet"),window.history.pushState({},"",document.location.pathname+e)}function W(e,n,o){const i=o[e].dataset.ilb2Id??e.toString();let r=F(document.location.search,"imageLightboxIndex",i);const t={imageLightboxIndex:i,imageLightboxSet:""};n!==void 0&&(t.imageLightboxSet=n,r=F(r,"imageLightboxSet",n)),window.history.pushState(t,"",document.location.pathname+r)}function G(e,n,o){if(B("imageLightboxSet")!==e)return;const i=B("imageLightboxIndex");if(i===void 0)return;let r=n.findIndex(t=>t.dataset.ilb2Id===i);r<0&&(r=parseInt(i,10)),o(r,!0)}function Y(e,n,o,i,r,t,s){const f=e.state;if(!f||Object.keys(f).length===0){t(!0);return}if(f.imageLightboxSet!==n)return;const u=f.imageLightboxIndex;if(u===void 0){t(!0);return}let m=o.findIndex(L=>L.dataset.ilb2Id===u);if(m<0&&(m=parseInt(u,10)),i===null){r(m,!0);return}s(m,m>i?y.Right:y.Left,!0)}const g=document.createElement("div");g.setAttribute("id","ilb-container");let N=null;function Z(e,n,o){g.classList.remove("ilb-overlay"),document.body.classList.add("ilb-body"),document.body.appendChild(g),n&&(N=i=>{i.stopPropagation(),o()},g.addEventListener("click",N),g.addEventListener("touchend",N)),g.style.transition=`opacity ${e.toString()}ms ease`,setTimeout(()=>{g.style.opacity="1"},50)}function _(){g.classList.add("ilb-overlay")}function ee(){g.style.opacity="0"}function te(){N!==null&&(g.removeEventListener("click",N),g.removeEventListener("touchend",N)),g.remove(),g.textContent="",document.body.classList.remove("ilb-body")}function E(){return g}const q=document.createElement("div");q.setAttribute("id","ilb-activity-indicator"),q.appendChild(document.createElement("div"));function j(){E().appendChild(q)}function X(){q.remove()}const I=document.createElement("div");I.classList.add("ilb-button","ilb-arrow"),I.setAttribute("id","ilb-arrow-left");const k=document.createElement("div");k.classList.add("ilb-button","ilb-arrow"),k.setAttribute("id","ilb-arrow-right");let C=null,O=null;function ne(e,n){C=o=>{o.stopPropagation(),e()},O=o=>{o.stopPropagation(),n()},I.addEventListener("click",C),I.addEventListener("touchend",C),k.addEventListener("click",O),k.addEventListener("touchend",O),E().append(I,k)}function ie(){I.remove(),C!==null&&(I.removeEventListener("click",C),I.removeEventListener("touchend",C)),O!==null&&(k.removeEventListener("click",O),k.removeEventListener("touchend",O)),C=null,O=null}const x=document.createElement("caption");x.setAttribute("id","ilb-caption"),x.textContent="&nbsp;",x.addEventListener("click",e=>{e.stopPropagation()});function oe(e,n){e!==""?(E().appendChild(x),x.style.transition=`opacity ${n.toString()}ms ease`,setTimeout(()=>{x.style.opacity="1"},1),x.textContent=e):(x.style.opacity="0",setTimeout(()=>{x.remove()},n))}const P=document.createElement("button");P.classList.add("ilb-button"),P.setAttribute("id","ilb-close-button");let H=null;function re(e){H=n=>{n.stopPropagation(),e()},P.addEventListener("click",H),E().appendChild(P)}function ae(){H!==null&&P.removeEventListener("click",H),P.remove()}const le=document.fullscreenEnabled||(document.webkitFullscreenEnabled??!1);function se(){return document.fullscreenElement??document.webkitFullscreenElement??null}const de=e=>{(e.requestFullscreen||e.webkitRequestFullScreen).call(e)},ce=()=>{(document.exitFullscreen||document.webkitExitFullscreen).call(document)};function ue(){se()===null?de(E()):ce()}const R=document.createElement("button");R.classList.add("ilb-button"),R.setAttribute("id","ilb-fullscreen-button"),R.innerHTML="&#x26F6;",R.addEventListener("click",e=>{e.stopPropagation(),ue()});function fe(){E().appendChild(R)}function me(){R.remove()}function ge(e,n,o){let i=0,r=0,t=document.createElement("img");t.setAttribute("id","ilb-image"),t.setAttribute("src",e.getAttribute("href")??"");const s=document.createElement("div");s.classList.add("ilb-image-container");let f;const u=e.dataset.ilb2VideoId;let m=e.dataset.ilb2Video!==void 0&&u!==void 0;if(m){const c=o.get(u);c!==void 0?[t,f]=c.element():m=!1}s.appendChild(t);function L(c,p,b,$){if(m){const a=o.get(u);if((a==null?void 0:a.shouldAutoplay())===!0){const[l,d]=a.element();d?l.play():l.autoplay=!0}}else t.addEventListener("click",a=>{if(a.stopPropagation(),n.quitOnImgClick){$();return}(a.pageX-t.offsetLeft)/t.width<=1/3?p():b()});t.addEventListener("touchstart",a=>{i=a.touches[0].pageX,t.style.transitionProperty="opacity"}),t.addEventListener("touchmove",a=>{r=a.touches[0].pageX-i,t.style.left=`${r.toString()}px`}),t.addEventListener("touchend",a=>{a.stopPropagation(),t.style.transitionProperty="left, opacity",r>50&&p(),r<-50&&b(),t.style.left="0"}),t.addEventListener("touchcancel",a=>{a.stopPropagation(),t.style.transitionProperty="left, opacity",t.style.left="0"}),c()}function S(c,p){E().appendChild(s);const b=Math.abs(100-n.gutter);t.style.maxHeight=`${b.toString()}%`,t.style.maxWidth=`${b.toString()}%`,t.style.left=`${(-100*c).toString()}px`,t.style.transition=`all ease ${n.animationSpeed.toString()}ms`,setTimeout(p,50)}function T(c,p){t.addEventListener("error",p),f===!0?c():(t.addEventListener("load",c),t.addEventListener("loadedmetadata",c))}function v(c,p,b,$){t.style.left="0",t.style.opacity="1",setTimeout(()=>{L(c,p,b,$)},n.animationSpeed)}function A(c,p){if(c!==y.None){const b=parseInt(t.style.left,10)||0;t.style.left=`${(b+100*c).toString()}px`}t.style.opacity="0",setTimeout(()=>{p()},n.animationSpeed)}function M(){s.remove()}return{addToDOM:S,removeFromDOM:M,startLoading:T,transitionIn:v,transitionOut:A}}let Q=null;function pe(e,n,o,i){e.enableKeyboard&&(Q=r=>{r.key==="Escape"&&(r.preventDefault(),n()),r.key==="ArrowLeft"&&(r.preventDefault(),o()),r.key==="ArrowRight"&&(r.preventDefault(),i())},document.addEventListener("keyup",Q))}function ve(){Q!==null&&document.removeEventListener("keyup",Q)}const w=document.createElement("div");w.classList.add("ilb-navigation");function z(e,n,o,i){for(let r=0;r<e.length;r++){const t=document.createElement("button");t.style.transition=`background-color ${i.toString()}ms ease`;const s=()=>{const f=n();if(t.classList.contains("ilb-navigation-active")||f===null||t.parentNode===null)return;const u=Array.prototype.indexOf.call(t.parentNode.childNodes,t),m=u<f?y.Left:y.Right;o(u,m)};t.addEventListener("click",s),t.addEventListener("touchend",s),w.appendChild(t)}}function J(e){var n,o;for(let i=0;i<w.children.length;i++)(n=w.children.item(i))==null||n.classList.remove("ilb-navigation-active");(o=w.children.item(e))==null||o.classList.add("ilb-navigation-active")}function be(e,n,o,i){w.textContent="",z(e,n,o,i);const r=n();r!==null&&J(r),E().appendChild(w),w.addEventListener("click",t=>{t.stopPropagation()}),w.addEventListener("touchend",t=>{t.stopPropagation()})}function he(e,n){let o=e.dataset.ilb2Id;o===void 0&&(o=`a${((1+Math.random())*65536|0).toString(16)}`),e.dataset.ilb2VideoId=o;const i=o,r=document.createElement("video");r.setAttribute("id","ilb-image"),r.preload="metadata",r.dataset.ilb2VideoId=i;let t=!1,s=!1;for(const[L,S]of Object.entries(n))switch(L){case"autoplay":s=!0;break;case"controls":case"loop":case"muted":case"poster":case"preload":case"src":r.setAttribute(L,S.toString());break}if(n.sources)for(const L of n.sources){const S=document.createElement("source");for(const[T,v]of Object.entries(L))S.setAttribute(T,v);r.appendChild(S)}r.addEventListener("loadedmetadata",()=>{t=!0});function f(){return i}function u(){return[r,t]}function m(){return s}return{element:u,id:f,shouldAutoplay:m}}function ye(){const e=[];function n(i){for(const r of i){const t=r.dataset.ilb2Video;t!==void 0&&e.push(he(r,JSON.parse(t)))}}function o(i){return e.find(r=>r.id()===i)}return{add:n,get:o}}function Ee(e,n,o){const i=[],r=ye();let t=null,s=null;function f(){return n}function u(){return i}function m(a,l){if(s===null)return;const d=s;d.transitionOut(a,()=>{d.removeFromDOM(),l==null||l()})}function L(){s==null||s.transitionIn(X,M,c,v)}function S(a){s==null||s.addToDOM(a,()=>{var d;if(t===null)return;const l=i[t];if(e.caption&&oe(l.dataset.ilb2Caption??((d=l.getElementsByTagName("img").item(0))==null?void 0:d.alt)??"",e.animationSpeed),L(),e.preloadNext&&t+1<i.length){const V=i[t+1];document.createElement("img").setAttribute("src",V.getAttribute("href")??"")}E().dispatchEvent(new Event("ilb:loaded",{bubbles:!0}))})}function T(a,l){const d=ge(i[a],e,r);t=a,s=d,d.startLoading(()=>{S(l)},()=>{X()})}function v(a=!1){t!==null&&(e.activity&&j(),ve(),e.history&&!a&&U(),E().dispatchEvent(new Event("ilb:quit",{bubbles:!0})),ee(),m(y.None,()=>{t=null,s=null,ie(),ae(),me(),te()}))}function A(a,l,d=!1){t!==null&&(e.history&&!d&&W(a,f(),u()),e.activity&&j(),J(a),m(l),T(a,l))}function M(){if(t===null)return;let a=t-1;if(t===0){if(e.quitOnEnd){v();return}a=i.length-1}i[a].dispatchEvent(new Event("ilb:previous",{bubbles:!0})),A(a,y.Left)}function c(){if(t===null)return;let a=t+1;if(t===i.length-1){if(e.quitOnEnd){v();return}a=0}i[a].dispatchEvent(new Event("ilb:next",{bubbles:!0})),A(a,y.Right)}function p(a,l=!1){t===null&&(Z(e.animationSpeed,e.quitOnDocClick,v),e.activity&&j(),pe(e,v,M,c),e.arrows&&ne(M,c),e.button&&re(v),e.fullscreen&&le&&fe(),e.overlay&&_(),e.history&&!l&&W(a,f(),u()),i[a].dispatchEvent(new Event("ilb:start",{bubbles:!0})),T(a,y.None),e.navigation&&be(u(),()=>t,A,e.animationSpeed))}function b(a){const l=i.indexOf(a);l<0||p(l)}function $(a){const l=a.filter(d=>!i.includes(d)).filter(d=>d.tagName.toLowerCase()==="a"&&(new RegExp(`.(${e.allowedTypes})$`,"i").test(d.href)||d.dataset.ilb2Video!==void 0));r.add(l),i.push(...l);for(const d of l)d.addEventListener("click",V=>{V.preventDefault(),V.stopPropagation(),b(d)});z(l,()=>t,A,e.animationSpeed)}return $(o),e.history&&window.addEventListener("popstate",a=>{Y(a,f(),u(),t,p,v,A)}),{addImages:$,close:v,images:u,next:c,open:p,openWithImage:b,previous:M,set:f}}class Le{constructor(n,o){const i={activity:!0,allowedTypes:"",animationSpeed:250,arrows:!0,button:!0,caption:!1,enableKeyboard:!0,fullscreen:!0,gutter:10,history:!1,navigation:!1,overlay:!0,preloadNext:!0,quitOnDocClick:!0,quitOnEnd:!0,quitOnImgClick:!1,...o};this.s=Ee(i,n.length>0?n[0].dataset.imagelightbox??"":"",Array.from(n)),i.history&&this.openHistory()}addImages(n){this.s.addImages(Array.from(n))}close(){this.s.close()}next(){this.s.next()}open(n){n!==void 0?this.s.openWithImage(n):this.s.open(0)}openHistory(){G(this.s.set(),this.s.images(),(n,o)=>{this.s.open(n,o)})}previous(){this.s.previous()}}h.fn.imageLightbox=function(e){const n=new Le(this.get(),e);return this.addToImageLightbox=o=>{n.addImages(o.get())},this.openHistory=()=>{n.openHistory()},this.loadPreviousImage=()=>{n.previous()},this.loadNextImage=()=>{n.next()},this.quitImageLightbox=function(){return n.close(),this},this.startImageLightbox=o=>{n.open(o==null?void 0:o.get(0))},this};const D=h(document);D.on("ilb:start",e=>{h("#ilb-container").trigger("start.ilb2",e.target)}),D.on("ilb:quit",()=>{h("#ilb-container").trigger("quit.ilb2")}),D.on("ilb:loaded",()=>{h("#ilb-container").trigger("loaded.ilb2")}),D.on("ilb:previous",e=>{h("#ilb-container").trigger("previous.ilb2",e.target)}),D.on("ilb:next",e=>{h("#ilb-container").trigger("next.ilb2",e.target)})});
//# sourceMappingURL=imagelightbox.jquery.umd.cjs.map
